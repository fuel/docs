<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Tasks - Fuel Documentation</title>
<link href="../assets/css/main.css" media="screen" rel="stylesheet" />
<script type="text/javascript" src="../assets/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="../assets/js/nav.js"></script>
<script type="text/javascript" src="../assets/js/highlight.pack.js"></script>
<script type="text/javascript">
		$(function() {
			show_nav('general', '../');
		});
		hljs.tabReplace = '    ';
		hljs.initHighlightingOnLoad();
	</script>
</head>
<body>
<header>
  <h1>Fuel Documentation</h1>
</header>
<div id="main-nav"></div>
<section id="content">
  <h2>Tasks</h2>
  <h3 id="what_are_tasks">What is a task?</h3>
  <p>Tasks are classes that can be run through the command line or set up as a cron job. They are generally used for background processes, timed tasks and maintenance tasks. Tasks can calls models and other classes just like controllers. Tasks have full access to the Fuel framework and any data models that you may have. </p>
  <h3 id="creating_tasks">Creating a task</h3>
  <p>In Fuel Controllers are put in the <kbd>fuel/app/tasks</kbd> directory. Below is an example of the task "example": </p>
  <pre class="php"><code>namespace Fuel\Tasks;

class Example {

	public function run($message = 'Hello!')
	{
		echo $message;
	}
}</code></pre>
  <p>That will be called via the refine utility within oil:</p>
  <pre class="cli">$ php oil refine example "Good morning"</pre>
  <p>When just the name of the task is used in the command, the method <kbd>"run()"</kbd> is referenced.</p>
  <h4 id="more_methods">Splitting tasks into more methods</h4>
  <p>You can add more methods to your task class to break a group of tasks down into more specific tasks which can be called separately.</p>
  <pre class="php"><code>public function current_date()
{
	echo date('Y-m-d');
}</code></pre>
  <p>We can then call this method using:</p>
  <pre class="cli">$ php oil refine example:current_date</pre>
  <h4>Example: Seeding Test Data</h4>
  <p>In this example, we can seed some test data into a database.</p>
  <pre class="php"><code>public function current_date()
{
/**
 * Seed data
 */

namespace Fuel\Tasks;

class Seed
{

	public static $tables = array(
		'users',
		'groups'
	);

	/**
	 * Seeds data
	 */
	public static function run()
	{
		self::truncate_tables();
		self::create_groups();
		self::create_users();
	}

	/**
	 * Truncates tables
	 */
	private static function truncate_tables()
	{
		//First, truncate all tables
		foreach (self::$tables as $table)
		{
			$query = \DB::query("TRUNCATE TABLE `{$table}`");
			$query->execute();
		}
	}

	/**
	 * Creates new groups
	 */
	private static function create_groups()
	{
    	//Create two groups - admin and members
		$groups = array(
			'admin',
			'members'
		);
		
		foreach ($groups as $group_name)
		{
			echo "Creating group {$group_name}".PHP_EOL;
			$group = new \Model_Group();			//Here, a Task can access your data models
			$group->name = $group_name;
			$group->save();
		}
		
	}

	/**
	 * Creates new users
	 */
	private static function create_users()
	{
		$users = array(
			array(
				'email' => 'example@example.com',
				'password' => 'example',
				'first_name' => 'John',
				'last_name' => 'Doe',
				'username' => 'johndoe',
				'group_id' => '1'
			),
		);
		
		foreach ($users as $user_arr)
		{
			echo "Creating user: {$user_arr['email']}".PHP_EOL;
			$user = \Model_User::factory($user_arr);	
			$user->save();
		}
	}
}
</code></pre>
  <p>You can then invoke the above easily in the command line:</p>
  <pre class="cli">$ php oil r seed</pre>
</section>
<section id="footer">
  <p> <a href="http://fuelphp.com">Fuel</a> is released under the MIT license.<br />
    &copy; 2010 - 2011 Fuel Development Team </p>
</section>
</body>
</html>