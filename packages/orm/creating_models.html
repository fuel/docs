<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="./../../assets/css/combined.css">
	<link rel="shortcut icon" href="./../../favicon.ico" />
	<script src="http://www.google.com/jsapi" type="text/javascript"></script>
	<script type="text/javascript">
		var path = './../../';
	</script>
	<script src="./../../assets/js/combined.js"></script>
	<title>Creating models - Orm Package - FuelPHP Documentation</title>
</head>
<body>
	<div id="container">
		<header id="header">
			<div class="table">
				<h1>
					<strong>FuelPHP, a PHP 5.3 Framework</strong>
					Documentation
				</h1>

				<form id="google_search">
					<p>
						<span id="search_clear">&nbsp;</span>
						<input type="submit" name="search_submit" id="search_submit" value="search" />
						<input type="text" value="" id="search_input" name="search_input" />
					</p>
				</form>
			</div>
			<nav>

				<div class="clear"></div>
			</nav>
			<a href="#" id="toc_handle">table of contents</a>
			<div class="clear"></div>
		</header>

		<div id="cse">
			<div id="cse_point"></div>
			<div id="cse_content"></div>
		</div>

		<div id="main">
			<section>
				<h2 id="creation">Create an ORM Model</h2>

				<p>ORM Models are stored in your <kbd>app/classes/model/</kbd> folder.</p>

				<p>The basic prototype for an ORM model class is this:</p>

				<pre class="php"><code>class Model_Name extends \Orm\Model
{
	protected static $_properties = array('id', 'example_column_name');
}</code></pre>
					
		
				<p>The convention is to use the <kbd>Model_</kbd> prefix for the class, but it is not required.</p>

				<p>For example, if your class is this:</p>

				<pre class="php"><code>class Model_Article extends \Orm\Model
{
	protected static $_properties = array('id', 'title', 'contents', 'publish');
}</code></pre>
				<p>Then your file should be this:</p>

				<pre class="text"><code>app/classes/model/article.php</code></pre>

				<p>And your table should be named this: 

				<pre class="text"><code>articles</code></pre>

				<p>By default, the table name should be the plural form of the file name. If you need the table name to be different than the file name, you can add the <a href="#table_name">$_table_name</a> configuration property to your ORM model class.</p>

				<p>There is an alternative way to create an ORM model, but it is not recommended because it is very inefficient.
				<br />
				The following code will automatically determine the tables <a href="#properties">$_properties</a> by making a query to the table. However, this is very inefficient. For every query you make to this model, it must first make an additional query to determine the tables columns and set <a href="#properties">$_properties</a>. 
				<br /></p>
				<p>Note: This alternative only works with MySQL and MySQLi.</p>

				<pre class="php"><code>class Model_Name extends \Orm\Model {}</code></pre>

				<h2 id="config">Configuration</h2>

				<p>You can add static properties to the Model to configure it. As we've seen there are none required but
					setting <kbd>$_properties</kbd> is encouraged. All these can be both <kbd>public</kbd> and
					<kbd>protected</kbd> but may NOT be <kbd>private</kbd>.<br />
					Note that all configuration properties are prefixed with a single underscore to prevent collisions with
					your column names.</p>

				<h3 id="table_name">protected static $_table_name</h3>

				<p>When this isn't set the <kbd>Model_</kbd> prefix is removed from the class name and the class name is
					pluralized. Thus "Model_Article" expects table "articles". If you don't follow this convention you can
					change it by setting the <kbd>$_table_name</kbd> property.</p>

				<pre class="php"><code>class Model_Article extends Orm\Model
{
	protected static $_table_name = 'myarticles';
}</code></pre>

				<h3 id="primary_key">protected static $_primary_key</h3>

				<p>By default this is set to <kbd>array('id')</kbd>, if you use another column name or multiple primary
					keys you need to set this property.</p>

				<pre class="php"><code>class Model_Article extends Orm\Model
{
	protected static $_primary_key = array('aid');
}</code></pre>

				<p class="note">The primary key must be a real primary key: unique and unchanging. Don't use it for other
					purposes (like a foreign key in a one-one relation) as well, that won't work as the PK can't be
					changed. The Orm won't check this, and while it might seem to work at first glance: you'll get
					into trouble.<br />
					It is not required for the PK to be auto_increment (though preferred) and you can specify the PK
					yourself, but only the first time. Once it's set, it's set.</p>

				<h3 id="properties">protected static $_properties</h3>

				<p>There's already a simple example above of adding all model properties, they can also be configured by
				using the column name as the key and setting options like type, label and validation.</p>

				<pre class="php"><code>class Model_Article extends Orm\Model
{
	protected static $_properties = array(
		'id', // both validation &amp; typing observers will ignore the PK
		'name' => array(
			'data_type' => 'varchar',
			'label' => 'Article Name',
			'validation' => array('required', 'min_length' => array(3), 'max_length' => array(20)),
			'form' => array('type' => 'text'),
			'default' => 'New article',
		),
		'gender' => array(
			'data_type' => 'varchar',
			'label' => 'Gender',
			'form' => array('type' => 'select', 'options' => array('m' => 'Male', 'f' => 'Female')),
			'validation' => array('required'),
		),
		'created_at' => array(
			'data_type' => 'int',
			'label' => 'Created At',
			'form' => array(
				'type' => false, // this prevents this field from being rendered on a form
			),
		),
		'updated_at' => array('data_type' => 'int', 'label' => 'Updated At')
	);
}</code></pre>

				<p>Form attributes can be passed in the form of an array as shown in the example.</p>

				<p>Validation rules can be passed as either just the rule: <kbd>array('required')</kbd> or as the rule
					with an array of params: <kbd>array('min_length' => array(3))</kbd> both are shown in the example
					above. A full explanation of the Validation class and it's rule can be found under
					<a href="../../classes/validation/validation.html">Core</a>.</p>

				<h3 id="conditions">protected static $_conditions</h3>

				<p>By default this property does not exist and Model::condition() returns <kbd>array()</kbd>, but you can set
				on the model if you want any conditions defined on every query run. Currently 'order_by' and 'where' conditions
				are supported.
				</p>

				<pre class="php"><code>class Model_Article extends Orm\Model
{
	protected static $_conditions = array(
		'order_by' => array('id' => 'desc'),
		'where' => array(
			array('publish_date', '>', 1370721177),
			array('published', '=', 1),
		),
	);
}</code></pre>
				<p class="note">
					The <kbd>order_by</kbd> condition is only applied if no other order by clause is defined.
					The <kbd>where</kbd> conditions are added using <kbd>and</kbd> to any other defined where clauses.
				</p>

				<h3 id="relations">protected static $_has_one, $_belongs_to, $_has_many, $_many_many</h3>

				<p>Relating models to each other is explained in <a href="relations/intro.html">Relating Models</a></p>

				<h3 id="connection">protected static $_connection</h3>

				<p>By default this property does not exist and Model::connection() returns <kbd>null</kbd>, but you can set
				it to any other database name configured in <kbd>app/config/db.php</kbd>.</p>

				<h3 id="write_connection">protected static $_write_connection</h3>

				<p>If you have a master/slave setup for your database environment, you can use this property to define the
				connection to use for the write master. If configured, the <kbd>$_connection</kbd> property will be used
				to connect to the read slaves.</p>
				<p>By default this property does not exist and Model::connection(true) returns either the configured <kbd>$_connection</kbd>,
				or <kbd>null</kbd>, but you can set it to any other database name configured in <kbd>app/config/db.php</kbd>.</p>

				<pre class="php"><code>// configuration for single database usage
class Model_Article extends Orm\Model
{
	// 'articles_db' has to be configured in your db.php configuration file
	protected static $_connection = 'articles_db';
}

// configuration for master/slave database usage
class Model_Article extends Orm\Model
{
	// 'articles_master_db' and 'articles_slave_db' have to be configured in your db.php configuration file
	protected static $_write_connection = 'articles_master_db';
	protected static $_connection = 'articles_slave_db';
}</code></pre>

				<p class="note">Note that relations do not work across connections, so when you define your connections in the model,
				make sure your related models have exactly the same configuration, both for reads and writes!</p>

				<h3 id="to_array_exclude">protected static $_to_array_exclude</h3>

				<p>
					If you are writing an API driven application, often you want to limit the columns that are exposed to the
					API interface. For example, when exposing a user record, you would not want to expose the user's password,
					login hash or salt.
				</p>
				<p>
					In your model definition, you can add a list of columns to the <strong>to_array_exclude</strong> array to exclude
					them from being exported using to_array().
				</p>
				<pre class="php"><code>class Model_User extends Orm\Model
{
	protected static $_to_array_exclude = array(
		'password', 'login_hash', 'salt'	// exclude these columns from being exported
	);
}</code></pre>
				<p class="note">
					By default the to_array() method exports both column and relation data loaded in the current model object.
					Optionally, it allows you to export the custom properties too. Array exclusion works on column names,
					custom properties and relations, allowing you to exclude properties from all of them.
				</p>

				<h3 id="observers">protected static $_observers</h3>

				<p>Adding observers is explained in <a href="observers/intro.html">Observers</a></p>
			</section>

		</div>

		<footer>
			<p>
				&copy; FuelPHP Development Team 2010-2013 - <a href="http://fuelphp.com">FuelPHP</a> is released under the MIT license.
			</p>
		</footer>
	</div>
</body>
</html>
