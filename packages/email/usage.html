<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="./../../assets/css/combined.css?20190627">
	<link rel="shortcut icon" href="./../../favicon.ico" />
	<script src="https://www.google.com/jsapi" type="text/javascript"></script>
	<script type="text/javascript">
		var path = './../../';
	</script>
	<script src="./../../assets/js/combined.js?20190627"></script>
	<title>使い方 - Email パッケージ - FuelPHP ドキュメント</title>
</head>
<body>
	<div id="container">
		<header id="header">
			<div class="table">
				<div id="cse">
					<gcse:searchbox-only newWindow="true"></gcse:searchbox-only>
				</div>
				<h1>
					<a href="https://fuelphp.com"><img height="37px" width="147px" src="./../../assets/img/fuel.png" /></a>
					<strong>Documentation</strong>
				</h1>

			</div>
			<nav>
				<div class="clear"></div>
			</nav>
			<a href="#" id="toc_handle">目次</a>
			<div class="clear"></div>
		</header>

		<div id="main">

			<h2>Email パッケージの使用方法</h2>

			<p>email パッケージでメールを送るために必要な項目は、次の 3 つだけです。</p>

			<ol>
				<li>'送信者' のアドレス。</li>
				<li>受信者のアドレス。</li>
				<li>最後に大事な項目として、送りたいメッセージ</li>
			</ol>

			<h3 id="sending_mails">メールを送ってみましょう。</h3>

			<pre class="php"><code>// インスタンスを生成する
$email = Email::forge();

// 送信者のアドレスを指定する
$email->from('my@email.me', 'My Name');

// 受信者のアドレスを指定する
$email->to('receiver@elsewhere.co.uk', 'Johny Squid');

// 表題を指定する
$email->subject('This is the subject');

// 送信者のアドレスを複数指定する場合

$email->to(array(
	'example@mail.com',
	'another@mail.com' => 'With a Name',
));

// 本文を指定する。
$email->body('This is my message');
</code></pre>

			<p>この時点で、メールを送信する準備ができました。</p>

			<h3 id="exception">例外</h3>

			<p>メールを送信する際、次の 2 種類の例外が発生する可能性があります。</p>

			<ul>
				<li><strong>\EmailValidationFailedException</strong>: 1 つ以上のメールアドレスがバリデーションを通過しない場合に投げられます。</li>
				<li><strong>\EmailSendingFailedException</strong>: ドライバの例外でメール送信出来なかった場合</li>
			</ul>

			<p>下記の例では、これらの例外を扱う方法を示します。</p>

			<pre class="php"><code>try
{
	$email->send();
}
catch(\EmailValidationFailedException $e)
{
	// バリデーションが失敗したとき
}
catch(\EmailSendingFailedException $e)
{
	// ドライバがメールを送信できなかったとき
}</code></pre>

			<h3 id="html_mails">HTML メール。</h3>

			<p>HTML メールの送信も、普通のメールの送信とあまり変わりません:</p>

			<pre class="php"><code>// HTML の本文を指定する
$email->html_body(\View::forge('email/template', $email_data));

/** デフォルトでは、この機能は HTML から代替テキストも生成します。
	また、本文中のファイルを添付します (http://... のようなパスでないならば) 。      **/

// オプションで、代替テキストを指定する。
$email->alt_body('This is my alt body, for non-html viewers.');</code></pre>

			<h3 id="attachments">添付ファイル</h3>

			<p>
				Email パッケージは、通常の添付とインラインの 2 種類の添付方法をサポートします。
				メールの本文中に使いたい場合は、インライン添付を用います。例えば、図を挿入して、オフラインでも
				表示できるようにしたいときなどです。ただし、受信側のメーラーによっては対応していないことに注意してください。
			</p>

			<pre class="php"><code>// 添付ファイルを追加する
$email->attach(DOCROOT.'dir/my_img.png');

// インライン添付を追加する
// HTML に挿入するために cid を追加する
$email->attach(DOCROOT.'dir/my_img.png', true, 'cid:my_conten_id');
</code></pre>

			<p>テキストファイルを添付することもできます:</p>

			<pre class="php"><code>$contents = file_get_contents($my_file);
$email->string_attach($contents, $filename);
	</code></pre>

			<p>
				デフォルトでは、HTML 中の画像は自動的に添付されます。ただし、ローカルにあるファイルのみです。
				どのように動作するかは、下記の HTML を見てください。
			</p>

			<pre class="html"><code>&lt;!-- これは添付される --&gt;
&lt;img src="path/to/my/file.png" /&gt;

&lt;!-- これは添付されない --&gt;
&lt;img src="http://remote_host/file.jpeg" /&gt;

&lt;!-- これは添付されない --&gt;
&lt;img src="cid:my_conten_id" /&gt;
	</code></pre>

			<p>最後のタグ (cid:) も、自動的には添付されません。この例では、インライン添付を用いて、自分自身で添付する必要があります。</p>

			<h3 id="priorities">優先度</h3>

			<p>
				メールの優先度を変更するには、<a href="./methods.html#method_priority">priority</a> メソッドを使用します。
			</p>

			<pre class="php"><code>$email->priority(\Email::P_HIGH);</code></pre>

			<h3 id="pipelining">パイプライン</h3>

			<p>
				パイプラインは、一度に複数のメールを送信できる機能です。
			</p>

			<pre class="php"><code>$email->pipelining($true);</code></pre>

			<p>
				一度有効にすれば、同じメールサーバの接続を再利用して複数メールの構築や送信を行うために、同じ <code>$email</code> オブジェクトを使うことができます。
				メールサーバのホスティング会社がパイプラインを許可しているか、
				またメールの最大送信数がどれだけなのかを考慮しなくてはいけません。
			</p>
			<p>
				今のところ、 SMTP ドライバのみがパイプラインをサポートしています。
			</p>


            <h2 id="drivers">ドライバ</h2>
            <h3 id="mailgun">Mailgun ドライバ</h3>
            <p><a href="http://www.mailgun.com/">Mailgun</a> は、Rackspace によるメール送信サービスです。 <a href="https://github.com/mailgun/mailgun-php">Mailgun ライブラリ</a> を Composer であなたの FuelPHP にインストールする必要があります。</p>

            <p><i>composer.json</i> ファイルに次の行を追加して update コマンドを実行してください</p>

            <pre class="cli"><code class="body">"mailgun/mailgun-php": "1.6"</code></pre>

            <pre class="cli"><code>$ composer update</code></pre>

            <p>パッケージをインストールしたら、アプリケーションのための設定をしてください。</p>

            <pre class="php"><code>
/**
 * デフォルトの Email.php 設定をオーバーライドする
 */
return array(
    'defaults' => array(
        'driver' => 'mailgun',
        'mailgun' => array(
            'key' => 'あなたのキー',
            'domain' => 'あなたのドメイン'
        ),
    ),
);
            </code></pre>

        </div>

		<footer>
			<p>
				&copy; FuelPHP Development Team 2010-2019 - <a href="http://fuelphp.com">FuelPHP</a> is released under the MIT license.
[ <a href="https://github.com/fuel/docs/commits/1.8/master/packages/email/usage.html">原文コミット履歴</a> | <a href="https://github.com/NEKOGET/FuelPHP_docs_jp/commits/1.8/master_japanese/packages/email/usage.html">翻訳コミット履歴</a> | <a href="https://github.com/NEKOGET/FuelPHP_docs_jp/blob/1.8/develop_japanese/packages/email/usage.html">GitHubで修正</a> ]
			</p>
		</footer>

	</div>
</body>
</html>
